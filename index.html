<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
        const stopwords = 'a an and at but by for in nor of on or so the to up yet'
        const defaults = stopwords.split(' ')

        /**
         * Convert a value to AP/APA title case.
         *
         * @param {string} [value]
         *   Short text of unknown casing.
         * @param {Options} [options]
         *   Configuration (optional).
         * @returns {string}
         *   Title-cased version of `value`.
         */
        function apa_style_title_case(value, options) {
          const configuration = options || {}

          if (!value) return ''

          const stop = configuration.stopwords || defaults
          const keep = configuration.keepSpaces
          const splitter = /(\s+|[-‑–—,:;!?()])/

          return value
            .split(splitter)
            .map((word, index, all) => {
              // console.info("word: "+word + ", index: "+index);
              // The splitter:
              if (index % 2) {
                  if (/\s+/.test(word)) return keep ? word : ' '
                  return word
              }

              // 3.冒号、长破折号、句号后的第一个单词首字母大写
              if (index - 3 > 0 && all[index-3] == ':'){
                  return capitalize(word)
              }

              const lower = word.toLowerCase()

              if (index !== 0 && index !== all.length - 1 && stop.includes(lower)) {
                return lower
              }
              return capitalize(word)
            })
            .join('')
        }

        /**
         * 首字母大写
         * @param {string} value
         * @returns {string}
         */
        function capitalize(value) {
          return value.charAt(0).toUpperCase() + value.slice(1)
        }

        title_list = [
            '3 Best Discreet Dating Sites: the Biggest Secret To Find A Partner self-report',
            'MeetMe Dating Site: Why Meetme Is The Best Dating Site For Young People',
            "Wherever You Go, we'll Help You Find Love"
        ]
            // 3 Best Discreet Dating Sites: The Biggest Secret to Find a Partner Self-Report
            // MeetMe Dating Site: Why Meetme Is the Best Dating Site for Young People
            // Wherever You Go, We'll Help You Find Love
        for (var title of title_list) {
            d = apa_style_title_case(title);
            console.info(d);
        };

    </script>
    <script>
    $(document).ready(function(){
        // 标题自动进行 APA 格式化
        $("#title").on('keyup', function(e){
            if(e.keyCode == 37 || e.keyCode == 39) {
                return
            }
            var title = $(this).val();
            title = apa_style_title_case(title);
            var pos = $(this).getCursorPosition();
            $(this).val(title);
            // $(this).attr('style', 'color:green');
            setCaretPosition($(this)[0], pos);
        });
    });
    
    //获取光标位置
    (function ($, undefined) {
        $.fn.getCursorPosition = function () {
            var el = $(this).get(0);
            var pos = 0;
            if ('selectionStart' in el) {
                pos = el.selectionStart;
            } else if ('selection' in document) {
                el.focus();
                var Sel = document.selection.createRange();
                var SelLength = document.selection.createRange().text.length;
                Sel.moveStart('character', -el.value.length);
                pos = Sel.text.length - SelLength;
            }
            return pos;
        }
    })(jQuery);
    /**
     * 定位光标
     */
    function setCaretPosition(ctrl, pos){
        if(ctrl.setSelectionRange)
        {
            ctrl.focus();
            ctrl.setSelectionRange(pos,pos);
        }
        else if (ctrl.createTextRange) {
            var range = ctrl.createTextRange();
            range.collapse(true);
            range.moveEnd('character', pos);
            range.moveStart('character', pos);
            range.select();
        }
    }
    </script>
</head>
<body>
    
    <input type="text" id="title">

</body>
</html>
